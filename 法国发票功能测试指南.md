# 🇫🇷 法国发票功能测试指南

## 📋 测试概述

这份指南将帮助您系统性地测试法国发票功能，确保所有合规性要求都得到满足。测试分为7个主要部分，按优先级排序。

## ✅ 已完成的功能回顾

根据之前的开发工作，我们已经完成了以下功能：

### 🎯 核心合规性功能
- ✅ **法国法律字段集成** - SIREN、SIRET、TVA、RCS等字段
- ✅ **服务提供者身份声明** - 完整的企业身份信息
- ✅ **合规保证声明** - 符合法国商业法典的声明
- ✅ **增值税豁免声明** - 详细的TVA豁免条款
- ✅ **法律条款完整性** - 隐藏缺陷、付款条件等法定条款
- ✅ **重复字段问题修复** - 统一数据管理，消除字段冲突

### 🔧 技术实现
- ✅ **前端表单优化** - 法国发票专用表单组件
- ✅ **数据同步机制** - 主表单与法国字段的数据一致性
- ✅ **模板系统** - 标准、TVA豁免、自清算三种模板
- ✅ **预览功能** - 包含完整法律信息的发票预览

---

## 🧪 测试方案

### 🔴 高优先级测试（必须完成）

#### 1️⃣ 测试基本发票创建功能

**目标**: 验证能够成功创建包含法国法律字段的发票

**步骤**:
1. 打开发票软件 (http://localhost:3000)
2. 登录您的账户
3. 点击"创建新发票"
4. 选择"法国模板"
5. 填写以下信息：
   ```
   客户信息:
   - 公司名称: Test Client SARL
   - 地址: 456 Rue de Test, 75002 Paris
   - VAT号码: FR98765432109
   
   发票项目:
   - 描述: 咨询服务
   - 数量: 10
   - 单价: 100€
   - 税率: 20%
   ```
6. 点击"保存发票"

**预期结果**: 
- ✅ 发票创建成功
- ✅ 系统自动分配发票号码
- ✅ 所有字段保存正确

---

#### 2️⃣ 验证法国法律字段显示

**目标**: 确认SIREN、SIRET、TVA等字段在发票预览中正确显示

**步骤**:
1. 在上一步创建的发票中，点击"预览"
2. 检查发票头部的销售方信息区域
3. 验证以下字段是否显示：

**检查清单**:
```
销售方信息区域:
□ 公司名称显示正确
□ SIREN号码: 123456789
□ SIRET号码: 12345678901234  
□ TVA号码: FR12345678901
□ RCS号码: Paris B 123 456 789
□ 公司地址完整
□ 联系方式（电话、邮箱）
```

**预期结果**: 所有法律字段都应该清晰可见且格式正确

---

#### 3️⃣ 测试增值税计算

**目标**: 验证不同税率的计算准确性

**步骤**:
1. 创建新发票，添加以下项目：
   ```
   项目1: 标准服务 - 100€ × 1 = 100€ (20% TVA)
   项目2: 餐饮服务 - 50€ × 2 = 100€ (10% TVA)  
   项目3: 书籍销售 - 20€ × 5 = 100€ (5.5% TVA)
   ```

2. 检查计算结果：

**预期计算**:
```
小计: 300€
TVA明细:
- 20% TVA: 100€ × 0.20 = 20€
- 10% TVA: 100€ × 0.10 = 10€
- 5.5% TVA: 100€ × 0.055 = 5.5€
总TVA: 35.5€
总计: 335.5€
```

**检查清单**:
□ 小计计算正确
□ 各税率分别计算正确
□ TVA总额正确
□ 最终总额正确

---

### 🟡 中优先级测试（建议完成）

#### 4️⃣ 检查法律声明完整性

**目标**: 确认所有法定声明都正确显示

**步骤**:
1. 在发票预览页面，滚动到底部"法律条款"部分
2. 检查以下声明是否存在：

**检查清单**:
```
法律声明区域:
□ 服务提供者身份声明（蓝色框）
  - 包含公司名称、RCS、SIREN、SIRET信息
□ 合规保证声明（绿色框）
  - 确认符合法国商业法典
□ 隐藏缺陷条款
  - 引用民法典第1641条
□ 付款条件和逾期罚款
  - 30天付款期限，逾期罚款条款
□ 保留所有权条款
□ 争议解决条款
□ TVA信息声明
  - 根据模板类型显示相应内容
```

---

#### 5️⃣ 测试邮件发送功能

**目标**: 验证能够发送包含完整法律信息的发票邮件

**步骤**:
1. 在发票详情页面，点击"发送邮件"
2. 输入测试邮箱地址
3. 点击"发送"
4. 检查邮件内容

**检查清单**:
□ 邮件发送成功
□ 邮件包含发票PDF附件
□ 邮件正文包含法律字段信息
□ 邮件格式美观，法语本地化正确

---

#### 6️⃣ 测试PDF生成功能

**目标**: 生成并验证PDF发票的完整性

**步骤**:
1. 在发票预览页面，点击"下载PDF"
2. 打开下载的PDF文件
3. 检查PDF内容

**检查清单**:
□ PDF生成成功
□ 所有法律字段在PDF中可见
□ 格式美观，符合法国发票标准
□ 文字清晰，无乱码
□ 法律声明完整显示

---

### 🟢 低优先级测试（可选）

#### 7️⃣ 测试模板切换功能

**目标**: 验证不同法国发票模板的切换

**步骤**:
1. 创建新发票
2. 分别测试三种模板：

**模板测试**:
```
标准模板 (french-standard):
□ 显示标准20% TVA
□ 包含完整法律声明

TVA豁免模板 (french-exempt):
□ 显示"TVA non applicable"
□ 引用Art. 293 B du CGI
□ 无TVA计算

自清算模板 (french-autoliquidation):
□ 显示"Auto-liquidation"
□ 引用Art. 283-1 du CGI
□ 客户承担TVA责任
```

---

## 🚨 常见问题排查

### 如果测试失败，请检查：

1. **服务器运行状态**:
   ```bash
   # 检查前端服务
   http://localhost:3000
   
   # 检查后端服务  
   http://localhost:8080/api/health
   ```

2. **用户配置**:
   - 确保您的用户资料包含完整的法国法律字段
   - 检查SIREN、SIRET等字段是否已填写

3. **浏览器控制台**:
   - 按F12打开开发者工具
   - 查看Console标签页是否有错误信息

4. **网络连接**:
   - 确保前后端服务都在运行
   - 检查API调用是否成功

---

## 📊 测试结果记录

请在测试过程中记录结果：

```
测试日期: ___________
测试人员: ___________

高优先级测试:
□ 基本发票创建: 通过/失败
□ 法律字段显示: 通过/失败  
□ 增值税计算: 通过/失败

中优先级测试:
□ 法律声明完整性: 通过/失败
□ 邮件发送功能: 通过/失败
□ PDF生成功能: 通过/失败

低优先级测试:
□ 模板切换功能: 通过/失败

总体评价: ___________
发现的问题: ___________
```

---

## 🎯 测试成功标准

**完全成功**: 所有高优先级测试通过，中优先级测试至少通过80%
**基本成功**: 所有高优先级测试通过
**需要改进**: 任何高优先级测试失败

---

## 📞 技术支持

如果在测试过程中遇到问题，请：
1. 记录具体的错误信息
2. 截图保存问题现象
3. 检查浏览器控制台错误
4. 联系技术支持团队

---

**祝您测试顺利！** 🚀

这份测试指南将帮助您全面验证法国发票功能的合规性和稳定性。