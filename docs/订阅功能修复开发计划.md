# 订阅功能修复开发计划

## 🎯 总体目标
修复和完善订阅功能，确保用户体验流畅且功能限制正确实施。

## 📋 开发步骤

### ✅ 第1步：修复发票创建页面白屏问题
**状态：已完成**
- [x] 取消注释 `InvoiceCreationGuard` 导入
- [x] 恢复 `InvoiceCreationGuard` 组件包装
- [x] 测试页面正常显示

### 🔄 第2步：订阅徽章集成到侧边栏
**目标：** 将订阅徽章显示在左侧栏，替换不必要的 "invomate" 文字
**文件涉及：**
- `frontend/src/components/Layout/Sidebar.js`
- `frontend/src/components/SubscriptionBadge.js`

**任务：**
- [ ] 移除侧边栏中的 "invomate" 文字
- [ ] 集成 `SubscriptionBadge` 组件到侧边栏顶部
- [ ] 确保徽章样式与侧边栏设计一致
- [ ] 测试不同订阅状态下的显示效果

### 🔄 第3步：完善倒计时功能
**目标：** 确保倒计时功能在关键位置正确显示
**文件涉及：**
- `frontend/src/components/CountdownTimer.js`
- `frontend/src/components/SubscriptionGuard.js`
- `frontend/src/components/Dashboard/EnhancedDashboard.js`

**任务：**
- [ ] 检查 `CountdownTimer` 组件功能完整性
- [ ] 在仪表板添加倒计时显示
- [ ] 确保倒计时在试用期和订阅期都能正确显示
- [ ] 测试倒计时到期后的处理逻辑

### 🔄 第4步：重制订阅管理页面
**目标：** 改进订阅设置页面，显示剩余天数和订阅状态
**文件涉及：**
- `frontend/src/pages/SubscriptionSettings.js`
- `frontend/src/hooks/useSubscriptionTimer.js`

**任务：**
- [ ] 添加剩余天数显示
- [ ] 集成倒计时组件
- [ ] 显示订阅详细信息（计划类型、到期日期等）
- [ ] 添加升级/续费按钮
- [ ] 优化页面布局和用户体验

### 🔄 第5步：实施功能锁定机制
**目标：** 根据订阅状态限制功能访问
**文件涉及：**
- `frontend/src/components/Reports/EnhancedReports.js`
- `frontend/src/hooks/useSubscriptionFeatures.js`
- `frontend/src/components/SubscriptionGuard.js`

**任务：**
- [ ] 为 Reports 页面添加高级功能限制
- [ ] 统一订阅状态管理逻辑
- [ ] 实施发票数量限制检查
- [ ] 添加功能升级提示界面
- [ ] 测试所有功能限制场景

## 🔧 技术要点

### 订阅状态管理
- 使用 `useSubscriptionTimer` 获取订阅状态
- 通过 `useSubscriptionFeatures` 检查功能权限
- 确保状态同步和一致性

### 功能权限矩阵
```javascript
const featureMatrix = {
  'create_invoice': ['free', 'basic', 'professional', 'enterprise'],
  'unlimited_invoices': ['professional', 'enterprise'],
  'advanced_reports': ['professional', 'enterprise'],
  'advanced_templates': ['professional', 'enterprise']
};
```

### 用户体验原则
1. 清晰的订阅状态指示
2. 友好的升级提示
3. 平滑的功能限制过渡
4. 及时的到期提醒

## 📝 测试计划

### 功能测试
- [ ] 免费用户功能限制
- [ ] 试用期倒计时
- [ ] 订阅到期处理
- [ ] 升级流程测试

### 界面测试
- [ ] 订阅徽章显示
- [ ] 倒计时组件
- [ ] 升级提示界面
- [ ] 响应式设计

## 🚀 部署注意事项
- 确保后端订阅API正常工作
- 验证Paddle支付集成
- 测试生产环境订阅状态同步

---
**创建时间：** 2025年1月28日
**负责人：** 开发团队
**预计完成时间：** 按步骤逐步完成，每步确认后进行下一步