# 数据一致性检验清单

## 📋 页面检验清单

### 1. 仪表板页面 (Dashboard.js)
**数据源**: `/api/dashboard/unified-chart-data`, `/api/dashboard/stats`, `/api/dashboard/today-stats`

#### 检验项目:
- [ ] **KPI卡片数据一致性**
  - 总发票数 vs API返回的totalInvoices
  - 总收入 vs API返回的totalRevenue  
  - 待付款发票数 vs 发票状态统计
  - 已付款发票数 vs 发票状态统计

- [ ] **图表数据一致性**
  - 收入趋势图数据 vs `/api/dashboard/unified-chart-data`
  - 发票状态分布图 vs 实际发票状态统计
  - 月度统计数据 vs 数据库实际数据

- [ ] **实时数据更新**
  - 创建新发票后仪表板数据是否更新
  - 修改发票状态后图表是否更新
  - 删除发票后统计数据是否更新

### 2. 发票管理页面 (Invoices.js)
**数据源**: `/api/invoices`, `/api/invoices/stats/dashboard`

#### 检验项目:
- [ ] **发票列表数据**
  - 发票总数 vs 实际显示数量
  - 发票状态显示 vs 数据库状态
  - 发票金额显示 vs 计算结果

- [ ] **筛选和搜索功能**
  - 按状态筛选结果准确性
  - 按日期范围筛选结果准确性
  - 搜索功能结果准确性

- [ ] **分页功能**
  - 分页总数计算准确性
  - 每页显示数量一致性

### 3. 客户管理页面 (Clients.js)
**数据源**: `/api/clients`, `/api/clients/search/suggestions`

#### 检验项目:
- [ ] **客户列表数据**
  - 客户总数统计准确性
  - 客户信息显示完整性
  - 客户关联发票数量准确性

- [ ] **搜索和筛选**
  - 客户搜索结果准确性
  - 搜索建议功能准确性

### 4. 报表页面 (Reports.js)
**数据源**: `/api/reports/*` (多个端点)

#### 检验项目:
- [ ] **收入报表**
  - `/api/reports/revenue` 数据准确性
  - 月度/年度收入统计一致性
  - 收入趋势图数据准确性

- [ ] **客户报表**
  - `/api/reports/clients` 数据准确性
  - 客户排名统计准确性
  - 逾期客户列表准确性

- [ ] **税务报表**
  - `/api/reports/tax` 数据准确性
  - 税务计算准确性

### 5. 设置页面 (Settings.js)
**数据源**: `/api/settings/profile`, `/api/settings/subscription`

#### 检验项目:
- [ ] **用户资料数据**
  - 个人信息显示准确性
  - 订阅状态显示准确性

## 🔌 API端点检验清单

### 核心数据API
- [ ] **`/api/dashboard/unified-chart-data`**
  - 返回数据结构完整性
  - 数据计算准确性
  - 与其他API数据一致性

- [ ] **`/api/dashboard/stats`**
  - 统计数据准确性
  - 与实际数据库数据一致性

- [ ] **`/api/invoices`**
  - 发票列表完整性
  - 分页功能准确性
  - 筛选功能准确性

- [ ] **`/api/clients`**
  - 客户列表完整性
  - 客户信息准确性

### 报表API
- [ ] **`/api/reports/revenue`**
  - 收入计算准确性
  - 时间范围筛选准确性

- [ ] **`/api/reports/clients`**
  - 客户统计准确性
  - 排名计算准确性

- [ ] **`/api/reports/invoice-status`**
  - 状态分布统计准确性
  - 与实际发票状态一致性

## 🔄 数据同步检验

### 内存数据库模式
- [ ] **数据实例一致性**
  - API服务与测试脚本使用相同数据实例
  - 数据修改后所有接口同步更新

- [ ] **数据初始化**
  - 测试数据正确加载
  - 初始化数据与API返回一致

### 数据库模式
- [ ] **数据持久化**
  - 数据修改正确保存到数据库
  - 数据查询结果准确

- [ ] **事务一致性**
  - 相关数据修改保持一致性
  - 并发操作数据完整性

## 🧪 自动化测试项目

### 单元测试
- [ ] **数据计算函数**
  - 收入计算函数准确性
  - 统计计算函数准确性
  - 日期处理函数准确性

### 集成测试
- [ ] **API端点测试**
  - 所有API端点响应正确
  - 数据格式符合预期
  - 错误处理正确

### 端到端测试
- [ ] **用户操作流程**
  - 创建发票 → 仪表板更新
  - 修改发票状态 → 报表更新
  - 删除数据 → 统计更新

## 🔍 数据一致性验证脚本

### 验证脚本清单
- [ ] **`validate_dashboard_data.js`** - 验证仪表板数据一致性
- [ ] **`validate_invoice_data.js`** - 验证发票数据一致性
- [ ] **`validate_client_data.js`** - 验证客户数据一致性
- [ ] **`validate_reports_data.js`** - 验证报表数据一致性
- [ ] **`validate_api_consistency.js`** - 验证API间数据一致性

## 📊 性能检验

### 响应时间
- [ ] **API响应时间**
  - 所有API端点响应时间 < 2秒
  - 复杂查询响应时间 < 5秒

### 数据加载
- [ ] **页面加载性能**
  - 仪表板数据加载时间
  - 大量数据列表加载性能

## 🚨 错误处理检验

### API错误处理
- [ ] **网络错误处理**
  - 网络断开时的错误提示
  - 超时处理机制

- [ ] **数据错误处理**
  - 无效数据的错误提示
  - 数据格式错误处理

### 前端错误处理
- [ ] **组件错误边界**
  - 组件崩溃时的错误处理
  - 错误信息用户友好性

## 📝 检验执行计划

### 阶段1: 基础数据验证 (1-2天)
1. 执行所有数据一致性验证脚本
2. 修复发现的数据不一致问题
3. 验证修复效果

### 阶段2: 页面功能验证 (2-3天)
1. 逐页面执行检验清单
2. 记录发现的问题
3. 修复页面数据显示问题

### 阶段3: API端点验证 (1-2天)
1. 测试所有API端点
2. 验证数据格式和准确性
3. 修复API数据问题

### 阶段4: 集成测试 (1-2天)
1. 执行端到端测试
2. 验证数据流完整性
3. 确保所有功能正常

### 阶段5: 性能和错误处理验证 (1天)
1. 测试系统性能
2. 验证错误处理机制
3. 优化性能瓶颈

## ✅ 验收标准

### 数据一致性标准
- 所有页面显示数据与API返回数据100%一致
- 所有API端点返回数据与数据库数据100%一致
- 数据修改后所有相关显示实时更新

### 性能标准
- API响应时间 < 2秒
- 页面加载时间 < 3秒
- 大数据量操作响应时间 < 5秒

### 用户体验标准
- 所有错误都有友好的用户提示
- 加载状态有明确的视觉反馈
- 数据更新有实时反馈

---

**注意**: 此清单将作为数据一致性检验的完整指南，每个检验项目都需要详细记录结果和发现的问题。